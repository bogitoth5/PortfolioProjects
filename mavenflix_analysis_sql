MavenFlix - Exploratory Data Analysis in SQL

Questions:
-- How have MavenFlix subscriptions trended over time?

-- What percentage of customers have subscribed for 5 months or more?

-- What month had the highest subscriber retention, and the lowest?

-----------------------------------------------------------------------------------------------

-- How have MavenFlix subscriptions trended over time?
	-The beginning of 2023 had a high number of new subscriptions, and also summer months, with the all time highest number in July 2023. The end of 2022 has the lowest number. 
	-There is a bigger decrease in the number of subsriptions at the end of 2022 and on the spring of 2023. 2023 August also has a big decrease compared to July. 
	- Cancelations increased gradually in 2023.
  


SELECT YEAR(created_date), MONTH(created_date), COUNT(created_date), COUNT(created_date)- LAG(COUNT(created_date)) OVER () as difference
FROM mavenflix
WHERE canceled_date IS NOT NULL
GROUP BY YEAR(created_date), MONTH(created_date)
ORDER BY YEAR(created_date), MONTH(created_date);

SELECT YEAR(canceled_date), MONTH(canceled_date), COUNT(canceled_date), COUNT(canceled_date)- LAG(COUNT(canceled_date)) OVER () as difference
FROM mavenflix
WHERE canceled_date IS NOT NULL
GROUP BY YEAR(canceled_date), MONTH(canceled_date)
ORDER BY YEAR(canceled_date), MONTH(canceled_date);

-----------------------------------------------------------------------------------------------

-- What percentage of customers have subscribed for 5 months or more?

-- This query determines the subscription duration based on cancellation status and timing, and calculates percentage of users who subscribed to MavenFlix for 5 or more months:

If a user has no cancellation date before September 1, 2023 (the day after the analysis period ends), they are considered active, and the difference between the created date and September 1, 2023, is calculated.
If a user canceled on the same calendar day as their signup (even in a different month), one month is added to their subscription length.
If a user canceled after at least one full billing cycle, the difference between the created and canceled dates is calculated.
If a user canceled within less than a month, their subscription length is counted as one month.
If a user signed up on August 31, 2023, their subscription is considered to have lasted one month.

 WITH length AS (
 SELECT created_date, canceled_date, 
    CASE 
        WHEN canceled_date IS NULL THEN 
            CEILING(ROUND(DATEDIFF('2023-09-01', created_date)/ 30,2))
        WHEN DAY(created_date) = DAY(canceled_date) THEN 
            CEILING(ROUND(ABS(DATEDIFF(created_date, canceled_date))/ 30, 1))+1
        WHEN canceled_date > LAST_DAY(created_date) THEN 
            CEILING(ROUND(ABS(DATEDIFF(created_date, canceled_date))/ 30, 1))
        WHEN canceled_date <= LAST_DAY(created_date) THEN 1
        WHEN canceled_date IS NULL AND created_date = '2023-08-31' THEN 1
        ELSE 'NA'
    END AS subs_length
FROM mavenflix
)
SELECT 
    COUNT(CASE WHEN subs_length >= 5 THEN 1 END) * 100.0 / COUNT(*) AS percentage_users
FROM length;

-----------------------------------------------------------------------------------------------

-- What month had the highest subscriber retention, and the lowest?




